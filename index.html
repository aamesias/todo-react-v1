<!DOCTYPE html>
<html>
<head>
  <title>Todo</title>
  <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src='https://unpkg.com/babel-standalone@6/babel.min.js'></script>
  <link rel="stylesheet" type="text/css" href="style.css">

</head>

<body>
  <div id='app'></div>


  <script type='text/babel'>

    function AppTitle(props) {
        return (
            <h1>{props.title}</h1>
        )
    }

    function AddTodo(props) {
        return (
            <div>
                <input 
                    type={props.type}
                    placeholder={props.placeholder}
                    value={props.value}
                    onChange={props.onChange}
                    onKeyDown={props.onKeyDown}
                />
            </div>
        )
    }

    function MarkAllTodos(props) {
        if (props.todos.length !== 0) {
            return (
            <div>
                <button className='toggle-all' onClick={() => props.onToggleCompleteAllTodos()}>
                    ❯
                </button>
            </div>
            )
        }
        else {
            return null
        }
    }
    
    function Todos(props) {
        return (
            <div className='todo'>
                <ul className='todo-list'>
                    {props.list.map((todo) => (
                        // didn't have time to do double click to edit list text
                        // onDoubleClick change li to input box, if 'enter' is pressed, 
                        // change input box back to li with new item text
                        <li key={todo.item} onDoubleClick={() => props.onChangeTodoText(todo.item, todo.item + ' with tacos')}>
                            <label className='container'>
                                <input 
                                    type="checkbox"
                                    checked={!todo.isActive}
                                    onChange={() => {props.onToggleTodo(todo.item)}}
                                />
                                <span className='checkmark'></span>
                            </label>
                            <span style={{
                                textDecoration: todo.isActive ? 'none' : 'line-through'
                            }}>{todo.item}</span>
                            <button className='delete'
                                onClick={() => {props.onDeleteTodo(todo.item)}}>
                                ╳
                            </button>
                        </li>
                    ))}
                </ul>
            </div>
        )
    }

    function NumberOfItemsLeft(props) {
        const numOfItems = props.items.filter((todo) => todo.isActive === true).length
        if(numOfItems === 1) 
            return (<div className='todo-count'>{numOfItems} item left</div>)
        
        return (
            <div className='todo-count'>{numOfItems} items left</div>
        )
    }

    function Filters(props) {
        return (
            <ul className='filters'>
                <li style={{borderColor: (props.view === "all") ? 'red' : 'none'}}><a href='#all' onClick={() => {props.onViewChange('all')}}>All</a></li>
                <li style={{borderColor: (props.view === "active") ? 'red' : 'none'}}><a href='#active' onClick={() => {props.onViewChange('active')}}>Active</a></li>
                <li style={{borderColor: (props.view === "completed") ? 'red' : 'none'}}><a href='#completed' onClick={() => {props.onViewChange('completed')}}>Completed</a></li>
            </ul>
        )
    }

    function ClearCompleted(props) {
        return (
            <button 
                className='filters clear-completed' 
                onClick={() => {props.onClearCompleted()}}
            >
                Clear completed
            </button>
        )
    }

    // clean up if else conditional returns
    function StatusBar(props) {
        const todosCompleted = props.list.filter((todo) => todo.isActive === false).length
        
        if (props.list.length === 0) {
            return null
        }
        
        if ( todosCompleted !== 0){
            return (
                <div className='footer'>
                    <NumberOfItemsLeft 
                        items={props.list}  // when nesting components, what are naming conventions for props?
                    />                      
                    <Filters
                        view={props.view}
                        onViewChange={props.onViewChange}
                    />
                    <ClearCompleted 
                        onClearCompleted={props.onClearCompleted}
                    /> 
                </div>
            )
        } else {
            return (
                <div className='footer before'>
                    <NumberOfItemsLeft 
                        items={props.list}
                    />
                    <Filters 
                        view={props.view}
                        onViewChange={props.onViewChange}
                    />
                </div>
            )
        } 
    }

    class App extends React.Component {
        constructor(props) {
            super(props)

            this.state = {
                todos: [
                {
                    item: 'eat', 
                    isActive: true,
                }, 
                {
                    item: 'sleep',
                    isActive: true,
                }
                ],
                input: '',
                isAllComplete: false,
                view: 'all', // different possible views: all, active, completed
            }

            this.handleAddTodo = this.handleAddTodo.bind(this)
            this.updateInput = this.updateInput.bind(this)
            this.handleDeleteTodo = this.handleDeleteTodo.bind(this)
            this.toggleCompleteAllTodos = this.toggleCompleteAllTodos.bind(this)
            this.handleToggleTodo = this.handleToggleTodo.bind(this)
            this.updateView = this.updateView.bind(this)
            this.filterTodos = this.filterTodos.bind(this)
            this.handleClearCompleted = this.handleClearCompleted.bind(this)
            this.handleChangeTodoText = this.handleChangeTodoText.bind(this)
        }

        handleAddTodo(e) {
            if(this.state.input !== '' && e.keyCode === 13){
                this.setState((currentState) => {
                    return {
                        todos: currentState.todos.concat([{
                            item: this.state.input,
                            isActive: true
                        }]), 
                        input: '',
                        isAllComplete: false,
                    }
                
                })
            }

        }

        handleDeleteTodo(item) {
            this.setState((currentState) => {
                const newStateOfTodos = currentState.todos.filter((todo) => todo.item !== item)
                const numOfActiveItems = newStateOfTodos.filter((todo) => todo.isActive === true).length
                if (numOfActiveItems === 0) {
                    return {
                        isAllComplete: true,
                        todos: newStateOfTodos
                    }
                } else {
                    return {
                        isAllComplete: false,
                        todos: newStateOfTodos
                    }
                }
            }) 
        }

        handleChangeTodoText(item, newItem, e) {

            this.setState((currentState) => {
                const newStateOfTodos = currentState.todos.map((todo) => {
                    if(todo.item === item) {
                        return ({ item: newItem, isActive: todo.isActive })
                    } else {
                        return ({ item: todo.item, isActive: todo.isActive })
                    }
                })
                return {todos: newStateOfTodos}
            })
        }

        updateInput(e) {
            const value = e.target.value

            this.setState({
                input: value
            })
        }

        handleToggleTodo(item) {
            this.setState((currentState) => {
                const newStateOfTodos = currentState.todos.map((todo) => {
                    if(todo.item === item) {
                        return ({ item: todo.item, isActive: !todo.isActive })
                    } else {
                        return ({ item: todo.item, isActive: todo.isActive })
                    }
                })
                const numOfActiveItems = newStateOfTodos.filter((todo) => todo.isActive === true).length
                if(numOfActiveItems === 0) {
                    return {
                        todos: newStateOfTodos, 
                        isAllComplete: true
                    }
                } else {
                    return {
                        todos: newStateOfTodos, 
                        isAllComplete: false
                    }
                }
                
            })
        }

        toggleCompleteAllTodos() {
            this.setState((currentState) => {
                return {
                    isAllComplete: !currentState.isAllComplete, 
                    todos: currentState.todos.map((todo) => ({ item: todo.item, isActive: currentState.isAllComplete }))
                }
            })
            console.log(this.state)
        }

        updateView(newView) {
            this.setState({
                view: newView
            })
        }

        filterTodos() {
            if (this.state.view === 'completed') {
                return this.state.todos.filter((todo) => todo.isActive === false)
            } else if (this.state.view === 'active') {
                return this.state.todos.filter((todo) => todo.isActive === true)
            } else {
                return this.state.todos
            }
                
        }

        handleClearCompleted() {
            this.setState((currentState) => {
                const newStateOfTodos = currentState.todos.filter((todo) => todo.isActive === true)
                const numOfActiveItems = newStateOfTodos.length
                if (numOfActiveItems === 0) {
                    return {
                        isAllComplete: true,
                        todos: newStateOfTodos
                    }
                } else {
                    return {
                        isAllComplete: false,
                        todos: newStateOfTodos
                    }
                }
            })
        }

        render() {
            return (
                <div className='todoapp'>
                    {console.log(this.state)}

                    <AppTitle 
                        title='todos'
                    />
                    <AddTodo 
                        type='text'
                        placeholder='What needs to be done?'
                        value={this.state.input}
                        onChange={this.updateInput}
                        onKeyDown={this.handleAddTodo}
                    />
                    <MarkAllTodos
                        onToggleCompleteAllTodos={this.toggleCompleteAllTodos}
                        todos={this.state.todos}
                    />
                    <Todos
                        list={this.filterTodos()}
                        onDeleteTodo={this.handleDeleteTodo}
                        onToggleTodo={this.handleToggleTodo}
                        onChangeTodoText={this.handleChangeTodoText}
                    />

                    <StatusBar 
                        list={this.state.todos}
                        onViewChange={this.updateView}
                        onClearCompleted={this.handleClearCompleted}
                        view={this.state.view}
                    />

                </div>
            )
        }
    }


    ReactDOM.render(
      <App />,
      document.getElementById('app')
    )
  </script>
</body>
</html>