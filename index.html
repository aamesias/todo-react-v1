<!DOCTYPE html>
<html>
<head>
  <title>Todo</title>
  <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src='https://unpkg.com/babel-standalone@6/babel.min.js'></script>
  <link rel="stylesheet" type="text/css" href="style.css">

</head>

<body>
  <div id='app'></div>


  <script type='text/babel'>

    function AppTitle(props) {
        return (
            <h1>{props.title}</h1>
        )
    }

    function AddTodo(props) {
        return (
            <input 
                type={props.type}
                placeholder={props.placeholder}
                value={props.value}
                onChange={props.onChange}
                onKeyDown={props.onKeyDown}
            />
        )
    }

    function MarkAllTodos(props) {
        return (
            <button  onClick={() => props.onToggleCompleteAllTodos()}>
                Toggle Completion
            </button>
        )
    }
    
    function Todos(props) {
        return (
            <div>
                <ul>
                    {props.list.map((todo) => (
                        <li key={todo.item}>
                            <input 
                                type="checkbox"
                                checked={!todo.isActive}
                                onChange={() => {props.onToggleTodo(todo.item)}}
                            />
                            <span>{todo.item}</span>
                            <button onClick={() => {props.onDeleteTodo(todo.item)}}>
                                X
                            </button>
                        </li>
                    ))}
                </ul>
            </div>
        )
    }

    function NumberOfItemsLeft(props) {
        const numOfItems = props.items.filter((todo) => todo.isActive === true).length
        if(numOfItems === 1) 
            return (<p>{numOfItems} item left</p>)
        
        return (
            <p>{numOfItems} items left</p>
        )
    }

    function Filters(props) {
        return (
            <ul>
                <li><a href='#all' onClick={() => {props.onViewChange('all')}}>All</a></li>
                <li><a href='#active' onClick={() => {props.onViewChange('active')}}>Active</a></li>
                <li><a href='#completed' onClick={() => {props.onViewChange('completed')}}>Completed</a></li>
            </ul>
        )
    }

    function ClearCompleted(props) {
        return (
            <button onClick={() => {props.onClearCompleted()}}>Clear completed</button>
        )
    }

    class App extends React.Component {
        constructor(props) {
            super(props)

            this.state = {
                todos: [
                {
                    item: 'eat', 
                    isActive: true,
                }, 
                {
                    item: 'sleep',
                    isActive: true,
                }
                ],
                input: '',
                isAllComplete: false,
                view: 'all', // different possible views: all, active, completed
            }

            this.handleAddTodo = this.handleAddTodo.bind(this)
            this.updateInput = this.updateInput.bind(this)
            this.handleDeleteTodo = this.handleDeleteTodo.bind(this)
            this.toggleCompleteAllTodos = this.toggleCompleteAllTodos.bind(this)
            this.handleToggleTodo = this.handleToggleTodo.bind(this)
            this.updateView = this.updateView.bind(this)
            this.filterTodos = this.filterTodos.bind(this)
            this.handleClearCompleted = this.handleClearCompleted.bind(this)
        }

        handleAddTodo(e) {
            if(this.state.input !== '' && e.keyCode === 13){
                this.setState((currentState) => {
                    return {
                        todos: currentState.todos.concat([{
                            item: this.state.input,
                            isActive: true
                        }]), 
                        input: '',
                        isAllComplete: false,
                    }
                
                })
            }

        }

        handleDeleteTodo(item) {
            this.setState((currentState) => {
                const newStateOfTodos = currentState.todos.filter((todo) => todo.item !== item)
                const numOfActiveItems = newStateOfTodos.filter((todo) => todo.isActive === true).length
                if (numOfActiveItems === 0) {
                    return {
                        isAllComplete: true,
                        todos: newStateOfTodos
                    }
                } else {
                    return {
                        isAllComplete: false,
                        todos: newStateOfTodos
                    }
                }
            }) 
        }

        updateInput(e) {
            const value = e.target.value

            this.setState({
                input: value
            })
        }

        handleToggleTodo(item) {
            this.setState((currentState) => {
                const newStateOfTodos = currentState.todos.map((todo) => {
                    if(todo.item === item) {
                        return ({ item: todo.item, isActive: !todo.isActive })
                    } else {
                        return ({ item: todo.item, isActive: todo.isActive })
                    }
                })
                const numOfActiveItems = newStateOfTodos.filter((todo) => todo.isActive === true).length
                if(numOfActiveItems === 0) {
                    return {
                        todos: newStateOfTodos, 
                        isAllComplete: true
                    }
                } else {
                    return {
                        todos: newStateOfTodos, 
                        isAllComplete: false
                    }
                }
                
            })
        }

        toggleCompleteAllTodos() {
            this.setState((currentState) => {
                return {
                    isAllComplete: !currentState.isAllComplete, 
                    todos: currentState.todos.map((todo) => ({ item: todo.item, isActive: currentState.isAllComplete }))
                }
            })
            console.log(this.state)
        }

        updateView(newView) {
            this.setState({
                view: newView
            })
        }

        filterTodos() {
            if (this.state.view === 'completed') {
                return this.state.todos.filter((todo) => todo.isActive === false)
            } else if (this.state.view === 'active') {
                return this.state.todos.filter((todo) => todo.isActive === true)
            } else {
                return this.state.todos
            }
                
        }

        handleClearCompleted() {
            this.setState((currentState) => {
                const newStateOfTodos = currentState.todos.filter((todo) => todo.isActive === true)
                const numOfActiveItems = newStateOfTodos.length
                if (numOfActiveItems === 0) {
                    return {
                        isAllComplete: true,
                        todos: newStateOfTodos
                    }
                } else {
                    return {
                        isAllComplete: false,
                        todos: newStateOfTodos
                    }
                }
            })
        }

        render() {
            return (
                <div>
                    {console.log(this.state)}

                    <AppTitle 
                        title='todos'
                    />
                    <AddTodo 
                        type='text'
                        placeholder='What needs to be done?'
                        value={this.state.input}
                        onChange={this.updateInput}
                        onKeyDown={this.handleAddTodo}
                    />
                    <MarkAllTodos
                        onToggleCompleteAllTodos={this.toggleCompleteAllTodos}
                    />
                    <Todos
                        list={this.filterTodos()}
                        onDeleteTodo={this.handleDeleteTodo}
                        onToggleTodo={this.handleToggleTodo}
                    />
                    <NumberOfItemsLeft 
                        items={this.state.todos}
                    />
                    <Filters
                        onViewChange={this.updateView}
                    />

                    <ClearCompleted
                        onClearCompleted={this.handleClearCompleted}
                    />

                </div>
            )
        }
    }


    ReactDOM.render(
      <App />,
      document.getElementById('app')
    )
  </script>
</body>
</html>